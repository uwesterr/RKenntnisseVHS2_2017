---
title: "Gapminder Shiny App in Markdown"
author: "Uwe Sterr"
date: "July 2016"
runtime: shiny
output: 
  html_document: 
    theme: readable
    code_folding: hide
    toc: yes
    toc_depth: 4
    toc_float: no
---



```{r cars,  echo=FALSE, warning=FALSE, message=FALSE}
load("modelsFile.RData")
library(gapminder)
library(dplyr)
library(purrr)
library(tidyr)
library(ggplot2)
library(broom)
library(purrr)
library(magrittr)
library(plotly)
library(shiny)

                             sliderInput(inputId = "rsqSliderValue",
                                         label = "R^2",
                                         value = c(0,0.25), min = 0, max = 1, dragRange = TRUE, step = 0.25)
                     
                           
selectInput('countrySelect', 'Country', as.character(unlist(c(models[, "country"]))),selected = "Germany")
selectInput('xcol', 'X Variable', names(unnest(models,data)), selected = "year")
selectInput('ycol', 'Y Variable', names(unnest(models,data)), selected = "pop")


renderPlotly(
    
    models %>% filter((rsq < input$rsqSliderValue[2] & rsq > input$rsqSliderValue[1]))  %>% unnest(rsq)  %>% top_n(10,rsq) %>% unnest(data) %>% ggplot(aes(year, lifeExp)) +
      geom_line(aes( colour = continent))  +
      facet_wrap(~country))
    
    renderPlotly(
    
    models %>% filter(country == input$countrySelect)  %>% unnest (data) %>% ggplot(aes(x=get(input$xcol), y=get(input$ycol))) + geom_line()  )
  

```


